{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificados</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap4.min.css" />

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
        }

        #institution {
            text-align: center;
            margin-bottom: 30px;
        }

        #institution img {
            max-width: 200px;
            margin-bottom: 15px;
        }

        table.dataTable tbody tr.shown td.dt-control::before {
            content: "-";
        }

        table.dataTable tbody tr td.dt-control::before {
            content: "+";
            cursor: pointer;
        }

        table.dataTable tbody tr.shown {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div id="institution">
        <h1 class="display-4">Certificados</h1>
        <img id="logo" src="{% static 'logo_2024.png' %}" alt="logo_2024">
        <p>Busca por nombres, apellidos, número de cédula, nombre del curso o código de verificación.</p>
    </div>

    <div>
        <form method="GET" action="" id="searchForm">
            <input type="text" name="q" id="searchInput" placeholder="buscar..." autocomplete="off">
            <input type="button" id="Elimina" value="Elimina">
            <input type="button" id="Limpiar" value="Limpiar">        
        </form>
    </div>

    <table id="myTable" class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th></th> <!-- Columna para el botón de expandir -->
                <th>CI</th>
                <th>Apellidos</th>
                <th>Nombres</th>
                <th>Curso</th>
            </tr>
        </thead>
        <tbody>
            {% for certificate in certificates %}
            <tr>
                <td class="dt-control"></td> <!-- Espacio para el botón de expandir -->
                <td>{{ certificate.national_id }}</td>
                <td>{{ certificate.holder_last_name }}</td>
                <td>{{ certificate.holder_first_name }}</td>
                <td>{{ certificate.course }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap4.min.js"></script>

<script>
    $(document).ready(function () {
        // Inicializar DataTable con opción de filas desplegables
        var table = $('#myTable').DataTable({
            columnDefs: [
                { className: 'dt-control', orderable: false, targets: 0 } // Controlador de despliegue en la columna 0
            ],
            order: [[1, 'asc']], // Ordenar por la columna "CI"
            language: {
                search: "Buscar:",
                lengthMenu: "Mostrar _MENU_ registros",
                info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
                infoEmpty: "No se encontraron registros",
                infoFiltered: "(filtrado de _MAX_ registros totales)"
            }
        });

        // Formato para mostrar información adicional
        function format(rowData) {
            return `
                <table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">
                    <tr><td>Horas Académicas:</td><td>20</td></tr>
                    <tr><td>Fecha Inicio:</td><td>05/11/2022</td></tr>
                    <tr><td>Fecha Fin:</td><td>05/13/2022</td></tr>
                    <tr><td>Cod Interno:</td><td>AULA-AF-1501-2022</td></tr>
                    <tr><td>Aval:</td><td>AULA MASTER</td></tr>
                </table>`;
        }

        // Hacer que al hacer clic en cualquier parte de la fila se expanda
        $('#myTable tbody').on('click', 'tr', function () {
            var tr = $(this);
            var row = table.row(tr);

            if (row.child.isShown()) {
                // Si la fila está expandida, colapsarla
                row.child.hide();
                tr.removeClass('shown');
            } else {
                // Expandir la fila
                row.child(format(row.data())).show();
                tr.addClass('shown');
            }
        });

        // Función para manejar la búsqueda
        $('#searchInput').on('input', function() {
            var searchValue = $(this).val();
            table.search(searchValue).draw(); // Realiza la búsqueda en la tabla
        });

        // Función para limpiar el campo de búsqueda (botón "Limpiar")
        $('#Limpiar').click(function() {
            $('#searchInput').val(''); // Limpiar el campo de búsqueda
            table.search('').draw(); // Mostrar todos los registros
        });

        // Función para eliminar la búsqueda y restaurar todos los registros (botón "Elimina")
        $('#Elimina').click(function() {
            $('#searchInput').val(''); // Eliminar el contenido del campo de búsqueda
            table.search('').draw(); // Eliminar la búsqueda y restaurar todos los registros
        });
    });
</script>
</body>
</html>
