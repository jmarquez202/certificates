{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificados</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap4.min.css" />

    <header>
        <div class="barra-superior"></div>
        <div class="barra-inferior"></div>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <!-- Contenido de tu menú de navegación -->
            <a class="navbar-brand" href="#">Inicio</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Oferta Académica</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Instituto</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Repositorio</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <style>
        header {
            position: relative;
        }
        
        .barra-superior {
            height: 50px; /* Altura de la barra superior */
            background-color: #007bff; /* Color azul */
        }
        
        .barra-inferior {
            height: 50px; /* Altura de la barra inferior */
            background-color: #0056b3; /* Color azul oscuro */
        }
        
      
        
        #searchInput {
            background-color: red;  /* Color de fondo del campo de búsqueda */
            padding: 10px;
            border: 1px solid #ccc;  /* Borde del campo de búsqueda */
            border-radius: 5px;  /* Bordes redondeados */
            width: 100px;  /* Ajusta el tamaño del campo de búsqueda */
            margin-right: 10px;  /* Espacio entre el campo de búsqueda y el primer botón */
        }
        
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
        }

        #institution {
            text-align: center;
            margin-bottom: 30px;
        }

        #institution h1.display-4 {
            color: #67768e; /* Azul oscuro */
            font-size: 3rem;
            font-weight: bold; /* Negrita */
            margin-bottom: 0.5rem;
        }


        #institution p {
            font-size: 2rem;
            font-weight: bold;
            color: #67768e; /* Azul más claro */
            margin-bottom: 1rem;
        }


        #institution img {
            max-width: 200px;
            margin-bottom: 15px;
        }

        table.dataTable tbody tr.shown td.dt-control::before {
            content: "-";
        }

        table.dataTable tbody tr td.dt-control::before {
            content: "+";
            cursor: pointer;
        }

        table.dataTable tbody tr.shown {
            background-color: #f9f9f9;
        }

        /* Ocultar el cuadro de búsqueda interno de DataTables */
        .dataTables_filter {
            display: none;
        }

        /* Alineación de los botones y barra de búsqueda */
        #searchForm {
            flex-grow: 1;
        }

        .d-flex {
            display: flex;
        }

        .justify-content-end {
            justify-content: flex-end;
        }

        #searchInput {
            width: 200px; /* Puedes ajustar el tamaño de la barra de búsqueda */
            margin-right: 10px; /* Espacio entre la barra de búsqueda y los botones */
        }

        .d-flex button {
            margin-left: 10px; /* Espacio entre los botones */
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div id="institution">
        <h1 class="display-4">Certificados</h1>
        <img id="logo" src="{% static 'logo_2024.png' %}" alt="logo_2024">
        <p>Busca por nombres, apellidos, número de cédula, nombre del curso o código de verificación.</p>
    </div>

    <div class="d-flex align-items-center mb-3">
        <!-- Campo de búsqueda y botón de buscar dentro de un contenedor flex -->
        <form method="GET" action="" id="searchForm" class="d-flex w-100">
            <input type="text" name="q" id="searchInput" class="form-control form-control-sm" placeholder="Buscar..." autocomplete="off">
            
            <!-- Solo el botón de buscar -->
            <button type="submit" id="limpiar" class="btn btn-primary btn-sm ml-2">limpiar</button>
            <button type="submit" id="limpiar" class="btn btn-primary btn-sm ml-2">eliminar</button>

        </form>
    </div>

    <!-- Tabla con los resultados -->
    <table id="myTable" class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th></th> <!-- Columna para el botón de expandir -->
                <th>CI</th>
                <th>Apellidos</th>
                <th>Nombres</th>
                <th>Curso</th>
            </tr>
        </thead>
        <tbody>
            {% for certificate in certificates %}
            <tr>
                <td class="dt-control"></td> <!-- Espacio para el botón de expandir -->
                <td>{{ certificate.national_id }}</td>
                <td>{{ certificate.holder_last_name }}</td>
                <td>{{ certificate.holder_first_name }}</td>
                <td>{{ certificate.course }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap4.min.js"></script>

<script>
    $(document).ready(function () {
        // Inicializar DataTable con opción de filas desplegables
        var table = $('#myTable').DataTable({
            columnDefs: [
                { className: 'dt-control', orderable: false, targets: 0 } // Controlador de despliegue en la columna 0
            ],
            order: [[1, 'asc']], // Ordenar por la columna "CI"
            language: {
                search: "Buscar:",
                lengthMenu: "Mostrar _MENU_ registros",
                info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
                infoEmpty: "No se encontraron registros",
                infoFiltered: "(filtrado de _MAX_ registros totales)"
            }
        });

        // Formato para mostrar información adicional
        function format(rowData) {
            return `
                <table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">
                    <tr><td>Horas Académicas:</td><td>20</td></tr>
                    <tr><td>Fecha Inicio:</td><td>05/11/2022</td></tr>
                    <tr><td>Fecha Fin:</td><td>05/13/2022</td></tr>
                    <tr><td>Cod Interno:</td><td>AULA-AF-1501-2022</td></tr>
                    <tr><td>Aval:</td><td>AULA MASTER</td></tr>
                </table>`;
        }

        // Función para manejar la búsqueda externa
        $('#searchInput').on('input', function() {
            var searchValue = $(this).val();
            table.search(searchValue).draw(); // Realiza la búsqueda en la tabla
        });

        // Hacer que al hacer clic en cualquier parte de la fila se expanda
        $('#myTable tbody').on('click', 'tr', function () {
            var tr = $(this);
            var row = table.row(tr);

            if (row.child.isShown()) {
                // Si la fila está expandida, colapsarla
                row.child.hide();
                tr.removeClass('shown');
            } else {
                // Expandir la fila
                row.child(format(row.data())).show();
                tr.addClass('shown');
            }
        });
    });
</script>
</body>
</html>
